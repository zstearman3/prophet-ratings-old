<% provide(:title, 'Predictions') %>

<h1>Predictions</h1>

<% todays_date = Date.parse(params[:date]) %>
<% previous_day = (todays_date - 1.day).strftime('%Y%m%d') %>
<% next_day = (todays_date + 1.day).strftime('%Y%m%d') %>
<%= link_to "Previous Day", predictions_path(date: previous_day) %>
<%= link_to "Next Day", predictions_path(date: next_day), class: 'align-right' %>
<% if todays_date < Date.today %>
  <table class="table table-sm">
    <thead>
      <tr>
        <th></th>
        <th colspan="3" class="center">Vegas Lines</th>
        <th colspan="3" class="center">Prophet Lines</th>
        <th colspan="6" class="center">Bet Outcomes</th>
        <th></th>
        <th></th>
      </tr>
      <tr>
        <th>Game</th>
        <th class="left-column">Spread</th>
        <th>O/U</th>
        <th>ML</th>
        <th class="left-column">Spread</th>
        <th>O/U</th>
        <th>ML</th>
        <th class="left-column">Spread</th>
        <th>Winnings</th>
        <th>O/U</th>
        <th>Winnings</th>
        <th>ML</th>
        <th>Winnings</th>
        <th class="left-column">Straight Up</th>
        <th class="left-column">Details</th>
      </tr>
    </thead>
    <tbody>
      <% @games.each do |game| %>
        <% prediction = game.prediction %>
        <tr>
          <td>
            <% description = game.away_team_name + " " + game.away_team_score.to_s + " @ " + game.home_team_name + " " + game.home_team_score.to_s %>
            <%= link_to description, game %>
          </td>
          <td class="left-column"><%= game.point_spread %></td>
          <td><%= game.over_under %></td>
          <td><%= game.home_team_money_line %></td>
          <% if prediction %>
            <td class="left-column"><%= prediction.predicted_point_spread %></td>
            <td><%= prediction.predicted_over_under %></td>
            <td><%= prediction.predicted_moneyline %></td>
            <td class="left-column">
              <% if prediction.win_point_spread == true %>
                WIN
              <% elsif prediction.win_point_spread == false %>
                LOSS
              <% else %>
                N/A
              <% end %>
            </td>
            <td><%= number_to_currency(prediction.winnings_point_spread) if prediction.winnings_point_spread %></td>
            <td>
              <% if prediction.win_over_under == true %>
                WIN
              <% elsif prediction.win_over_under == false %>
                LOSS
              <% else %>
                N/A
              <% end %>
            </td>
            <td><%= number_to_currency(prediction.winnings_over_under) if prediction.winnings_over_under %></td>
            <td>              
              <% if prediction.win_moneyline == true %>
                WIN
              <% elsif prediction.win_moneyline == false %>
                LOSS
              <% else %>
                N/A
              <% end %>
            </td>
            <td><%= number_to_currency(prediction.winnings_moneyline) if prediction.winnings_moneyline %></td>
            <td class="left-column"> 
            <% if prediction.win_straight_up == true %>
                WIN
              <% elsif prediction.win_straight_up == false %>
                LOSS
              <% else %>
                N/A
              <% end %></td>
            <td class="left-column"><%= link_to "Details", prediction %></td>
          <% end %>
        </tr>
      <% end %>
      <tr class="total-row">
        <th>Totals</th>
        <th colspan="3" class="left-column"></th>
        <th colspan="3" class="left-column"></th>
        <th class="left-column"><%= @predictions.where(win_point_spread: true).count.to_s + "-" + @predictions.where(win_point_spread: false).count.to_s %></th>
        <th><%= number_to_currency(@predictions.sum(:winnings_point_spread)) %></th>
        <th><%= @predictions.where(win_over_under: true).count.to_s + "-" + @predictions.where(win_over_under: false).count.to_s %></th>
        <th><%= number_to_currency(@predictions.sum(:winnings_over_under)) %></th>
        <th><%= @predictions.where(win_moneyline: true).count.to_s + "-" + @predictions.where(win_moneyline: false).count.to_s %></th>
        <th><%= number_to_currency(@predictions.sum(:winnings_moneyline)) %></th>
        <th class="left-column"><%= @predictions.where(win_straight_up: true).count.to_s + "-" + @predictions.where(win_straight_up: false).count.to_s %></th>
        <th class="left-column"></td>
      </tr>
    </tbody>
  </table>
<% else %>

<% end %>